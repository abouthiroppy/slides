(self.webpackChunkslides=self.webpackChunkslides||[]).push([[179],{7913:(n,e,r)=>{"use strict";r.r(e),r.d(e,{slides:()=>a,backgrounds:()=>p,fragmentSteps:()=>o,fusumaProps:()=>u,default:()=>i});var t=r(7401),l=r(9332);r(108),r(4780),r(6066),r(1687),r(230),r(1042);function s(){return(s=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}return n}).apply(this,arguments)}const a=[n=>(0,l.kt)(t.Fragment,null,(0,l.kt)("h1",null,"Source Maps v3")),n=>(0,l.kt)(t.Fragment,null,(0,l.kt)("p",null,"Node@16 で v3 が安定的となりました 🎉"),(0,l.kt)("br",null),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"$ NODE_OPTIONS=--enable-source-maps node dist/index.js\n")),(0,l.kt)("br",null),(0,l.kt)("p",null,"Node.js は生成されたコードが ",(0,l.kt)("inlineCode",{parentName:"p"},"//# sourceMappingURL=xxx.js.map")," を持っている場合、",(0,l.kt)("br",null),(0,l.kt)("inlineCode",{parentName:"p"},"require/import"),"でのロード時に sourcemap をキャッシュします。")),n=>(0,l.kt)(t.Fragment,null,(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"class MyError extends Error {\n  constructor(message: string) {\n    super(message);\n    Error.captureStackTrace(this, MyError);\n  }\n}\n\nthrow new MyError('This line is L:8');\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"# ===== 😭 =====\n$ node dist/index.js\n/dist/index.js:26 # 26は生成されたコードの行\nthrow new MyError('This line is L:8');\n^\n\nError: This line is L:8\n    at Object.<anonymous> (/dist/index.js:26:7)\n\n# ===== 👍 =====\n$ NODE_OPTIONS=--enable-source-maps node dist/index.js\n/src/index.ts:8 # 8はtypescriptで書かれたコードの実際の行\nthrow new MyError('This line is L:8');\n      ^\n\nError: This line is L:8\n    at Object.<anonymous> (/src/index.ts:8:7)\n"))),n=>(0,l.kt)(t.Fragment,null,(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"*.map")," ファイルの中身"),(0,l.kt)("br",null),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "version": 3,\n  "file": "index.js",\n  "sourceRoot": "",\n  "sources": ["../src/index.ts"],\n  "names": [],\n  "mappings": ";;;;;;;;;;;;;;;;AAAA;IAAsB,2BAAK;IACzB,iBAAY,OAAe;QAA3B,YACE,kBAAM,OAAO,CAAC,SAEf;QADC,KAAK,CAAC,iBAAiB,CAAC,KAAI,EAAE,OAAO,CAAC,CAAC;;IACzC,CAAC;IACH,cAAC;AAAD,CAAC,AALD,CAAsB,KAAK,GAK1B;AAED,MAAM,IAAI,OAAO,CAAC,kBAAkB,CAAC,CAAC"\n}\n')),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"http://sourcemaps.info/spec.html"},"spec"))),n=>(0,l.kt)(t.Fragment,null,(0,l.kt)("h2",null,"BASE64 VLQ CODEC"),(0,l.kt)("br",null),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"mappings"),"は Base64 VLQ で圧縮されていて、ソースのトランスパイル前後の位置を保存している。"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-txt"},"16) [0,0,0,0]\n17) [4,0,0,22], [27,0,0,5]\n18) [4,0,1,-25], [17,0,0,12], [7,0,0,15]\n19) [8,0,0,-27], [12,0,1,2], [18,0,0,6], [7,0,0,7], [1,0,0,1], [9,0,2,-15]\n20) [8,0,-1,1], [5,0,0,5], [1,0,0,1], [17,0,0,17], [1,0,0,1], [5,0,0,4], [2,0,0,2], [7,0,0,7], [1,0,0,1], [1,0,0,1]\n22) [4,0,1,-41], [1,0,0,1]\n23) [4,0,1,-3], [14,0,0,1]\n24) [0,0,0,-1], [1,0,0,1], [0,0,-5,-1], [1,0,0,22], [5,0,0,5], [3,0,5,-26]\n25) [0,0,2,-1], [6,0,0,6], [4,0,0,4], [7,0,0,7], [1,0,0,1], [18,0,0,18], [1,0,0,1], [1,0,0,1]\n")),(0,l.kt)("br",null),(0,l.kt)("p",null,"読みやすいように変換した形",(0,l.kt)("br",{parentName:"p"}),"\n",(0,l.kt)("inlineCode",{parentName:"p"},"([from_position](source_index)=>[to_position])")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-txt"},"([0,0](#0)=>[16,0])\n([0,22](#0)=>[17,4]) | ([0,27](#0)=>[17,31])\n([1,-25](#0)=>[18,4]) | ([1,-13](#0)=>[18,21]) | ([1,2](#0)=>[18,28])\n([1,-27](#0)=>[19,8]) | ([2,-25](#0)=>[19,20]) | ([2,-19](#0)=>[19,38]) | ([2,-12](#0)=>[19,45]) | ([2,-11](#0)=>[19,46]) | ([4,-26](#0)=>[19,55])\n([3,1](#0)=>[20,8]) | ([3,6](#0)=>[20,13]) | ([3,7](#0)=>[20,14]) | ([3,24](#0)=>[20,31]) | ([3,25](#0)=>[20,32]) | ([3,29](#0)=>[20,37]) | ([3,31](#0)=>[20,39]) | ([3,38](#0)=>[20,46]) | ([3,39](#0)=>[20,47]) | ([3,40](#0)=>[20,48])\n([4,-41](#0)=>[22,4]) | ([4,-40](#0)=>[22,5])\n([5,-3](#0)=>[23,4]) | ([5,-2](#0)=>[23,18])\n([5,-1](#0)=>[24,0]) | ([5,0](#0)=>[24,1]) | ([0,-1](#0)=>[24,1]) | ([0,21](#0)=>[24,2]) | ([0,26](#0)=>[24,7]) | ([5,0](#0)=>[24,10])\n([7,-1](#0)=>[25,0]) | ([7,5](#0)=>[25,6]) | ([7,9](#0)=>[25,10]) | ([7,16](#0)=>[25,17]) | ([7,17](#0)=>[25,18]) | ([7,35](#0)=>[25,36]) | ([7,36](#0)=>[25,37]) | ([7,37](#0)=>[25,38])\n")),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://www.murzwin.com/base64vlq.html"},"base64vlq"))),n=>(0,l.kt)(t.Fragment,null,(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"// 生成元コード\nclass MyError extends Error { // L: 1\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"// 生成元コードの分割されるトークン群, sourcemapsは0スタート\nclass MyError extends // ([0,0](#0)=>[16,0])\nError                 // ([0,22](#0)=>[17,4])\n {                    // ([0,27](#0)=>[17,31])\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"// 生成されたコード\nvar MyError = /** @class */ (function (_super) { // L:17\n    __extends(MyError, _super);                  // L:18\n"))),n=>(0,l.kt)(t.Fragment,null,(0,l.kt)("h2",null,"まとめ"),(0,l.kt)("br",null),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"トランスパイルされたコードを実行するときは、",(0,l.kt)("inlineCode",{parentName:"li"},"NODE_OPTIONS=--enable-source-maps"),"をつけると",(0,l.kt)("br",null),"デバッグが断然楽になる"),(0,l.kt)("li",{parentName:"ul"},"sourcemaps の仕組みは面白い"))),n=>(0,l.kt)(t.Fragment,null,(0,l.kt)("h1",null,"The End"))],p=[0,0,0,0,0,0,0,0],o=[0,0,0,0,0,0,0,0],u=[{},{},{},{},{},{},{},{}],A={};function i({components:n,...e}){return(0,l.kt)("wrapper",s({},A,e,{components:n,mdxType:"MDXLayout"}),(0,l.kt)("h1",null,"Source Maps v3"),(0,l.kt)("hr",null),(0,l.kt)("p",null,"Node@16 で v3 が安定的となりました 🎉"),(0,l.kt)("br",null),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"$ NODE_OPTIONS=--enable-source-maps node dist/index.js\n")),(0,l.kt)("br",null),(0,l.kt)("p",null,"Node.js は生成されたコードが ",(0,l.kt)("inlineCode",{parentName:"p"},"//# sourceMappingURL=xxx.js.map")," を持っている場合、",(0,l.kt)("br",null),(0,l.kt)("inlineCode",{parentName:"p"},"require/import"),"でのロード時に sourcemap をキャッシュします。"),(0,l.kt)("hr",null),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"class MyError extends Error {\n  constructor(message: string) {\n    super(message);\n    Error.captureStackTrace(this, MyError);\n  }\n}\n\nthrow new MyError('This line is L:8');\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"# ===== 😭 =====\n$ node dist/index.js\n/dist/index.js:26 # 26は生成されたコードの行\nthrow new MyError('This line is L:8');\n^\n\nError: This line is L:8\n    at Object.<anonymous> (/dist/index.js:26:7)\n\n# ===== 👍 =====\n$ NODE_OPTIONS=--enable-source-maps node dist/index.js\n/src/index.ts:8 # 8はtypescriptで書かれたコードの実際の行\nthrow new MyError('This line is L:8');\n      ^\n\nError: This line is L:8\n    at Object.<anonymous> (/src/index.ts:8:7)\n")),(0,l.kt)("hr",null),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"*.map")," ファイルの中身"),(0,l.kt)("br",null),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "version": 3,\n  "file": "index.js",\n  "sourceRoot": "",\n  "sources": ["../src/index.ts"],\n  "names": [],\n  "mappings": ";;;;;;;;;;;;;;;;AAAA;IAAsB,2BAAK;IACzB,iBAAY,OAAe;QAA3B,YACE,kBAAM,OAAO,CAAC,SAEf;QADC,KAAK,CAAC,iBAAiB,CAAC,KAAI,EAAE,OAAO,CAAC,CAAC;;IACzC,CAAC;IACH,cAAC;AAAD,CAAC,AALD,CAAsB,KAAK,GAK1B;AAED,MAAM,IAAI,OAAO,CAAC,kBAAkB,CAAC,CAAC"\n}\n')),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"http://sourcemaps.info/spec.html"},"spec")),(0,l.kt)("hr",null),(0,l.kt)("h2",null,"BASE64 VLQ CODEC"),(0,l.kt)("br",null),(0,l.kt)("p",null,(0,l.kt)("inlineCode",{parentName:"p"},"mappings"),"は Base64 VLQ で圧縮されていて、ソースのトランスパイル前後の位置を保存している。"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-txt"},"16) [0,0,0,0]\n17) [4,0,0,22], [27,0,0,5]\n18) [4,0,1,-25], [17,0,0,12], [7,0,0,15]\n19) [8,0,0,-27], [12,0,1,2], [18,0,0,6], [7,0,0,7], [1,0,0,1], [9,0,2,-15]\n20) [8,0,-1,1], [5,0,0,5], [1,0,0,1], [17,0,0,17], [1,0,0,1], [5,0,0,4], [2,0,0,2], [7,0,0,7], [1,0,0,1], [1,0,0,1]\n22) [4,0,1,-41], [1,0,0,1]\n23) [4,0,1,-3], [14,0,0,1]\n24) [0,0,0,-1], [1,0,0,1], [0,0,-5,-1], [1,0,0,22], [5,0,0,5], [3,0,5,-26]\n25) [0,0,2,-1], [6,0,0,6], [4,0,0,4], [7,0,0,7], [1,0,0,1], [18,0,0,18], [1,0,0,1], [1,0,0,1]\n")),(0,l.kt)("br",null),(0,l.kt)("p",null,"読みやすいように変換した形",(0,l.kt)("br",{parentName:"p"}),"\n",(0,l.kt)("inlineCode",{parentName:"p"},"([from_position](source_index)=>[to_position])")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-txt"},"([0,0](#0)=>[16,0])\n([0,22](#0)=>[17,4]) | ([0,27](#0)=>[17,31])\n([1,-25](#0)=>[18,4]) | ([1,-13](#0)=>[18,21]) | ([1,2](#0)=>[18,28])\n([1,-27](#0)=>[19,8]) | ([2,-25](#0)=>[19,20]) | ([2,-19](#0)=>[19,38]) | ([2,-12](#0)=>[19,45]) | ([2,-11](#0)=>[19,46]) | ([4,-26](#0)=>[19,55])\n([3,1](#0)=>[20,8]) | ([3,6](#0)=>[20,13]) | ([3,7](#0)=>[20,14]) | ([3,24](#0)=>[20,31]) | ([3,25](#0)=>[20,32]) | ([3,29](#0)=>[20,37]) | ([3,31](#0)=>[20,39]) | ([3,38](#0)=>[20,46]) | ([3,39](#0)=>[20,47]) | ([3,40](#0)=>[20,48])\n([4,-41](#0)=>[22,4]) | ([4,-40](#0)=>[22,5])\n([5,-3](#0)=>[23,4]) | ([5,-2](#0)=>[23,18])\n([5,-1](#0)=>[24,0]) | ([5,0](#0)=>[24,1]) | ([0,-1](#0)=>[24,1]) | ([0,21](#0)=>[24,2]) | ([0,26](#0)=>[24,7]) | ([5,0](#0)=>[24,10])\n([7,-1](#0)=>[25,0]) | ([7,5](#0)=>[25,6]) | ([7,9](#0)=>[25,10]) | ([7,16](#0)=>[25,17]) | ([7,17](#0)=>[25,18]) | ([7,35](#0)=>[25,36]) | ([7,36](#0)=>[25,37]) | ([7,37](#0)=>[25,38])\n")),(0,l.kt)("p",null,(0,l.kt)("a",{parentName:"p",href:"https://www.murzwin.com/base64vlq.html"},"base64vlq")),(0,l.kt)("hr",null),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"// 生成元コード\nclass MyError extends Error { // L: 1\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-ts"},"// 生成元コードの分割されるトークン群, sourcemapsは0スタート\nclass MyError extends // ([0,0](#0)=>[16,0])\nError                 // ([0,22](#0)=>[17,4])\n {                    // ([0,27](#0)=>[17,31])\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-js"},"// 生成されたコード\nvar MyError = /** @class */ (function (_super) { // L:17\n    __extends(MyError, _super);                  // L:18\n")),(0,l.kt)("hr",null),(0,l.kt)("h2",null,"まとめ"),(0,l.kt)("br",null),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"トランスパイルされたコードを実行するときは、",(0,l.kt)("inlineCode",{parentName:"li"},"NODE_OPTIONS=--enable-source-maps"),"をつけると",(0,l.kt)("br",null),"デバッグが断然楽になる"),(0,l.kt)("li",{parentName:"ul"},"sourcemaps の仕組みは面白い")),(0,l.kt)("hr",null),(0,l.kt)("h1",null,"The End"))}i.isMDXComponent=!0},4892:(n,e,r)=>{"use strict";r.r(e)},4855:(n,e,r)=>{var t={"./0-slide.md":7913};function l(n){var e=s(n);return r(e)}function s(n){if(!r.o(t,n)){var e=new Error("Cannot find module '"+n+"'");throw e.code="MODULE_NOT_FOUND",e}return t[n]}l.keys=function(){return Object.keys(t)},l.resolve=s,n.exports=l,l.id=4855}},n=>{"use strict";n.O(0,[179],(()=>[901,921,626].map(n.E)),5);var e=e=>n(n.s=e);n.O(0,[736],(()=>(e(7751),e(6905),e(9969))));n.O()}]);